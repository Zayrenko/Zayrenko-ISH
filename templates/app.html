<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI School Helper ‚Äî App</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            bg0: "#081F18",
            bg1: "#0E2F25",
            solidBar: "rgba(8, 31, 24, 0.92)",
            glass: "rgba(255,255,255,0.10)",
            stroke: "rgba(255,255,255,0.16)",
            mint: "#2EE59D",
            cyan: "#00D4FF",
            pinky: "#ff5aa6"
          },
          boxShadow: {
            soft: "0 18px 55px rgba(0,0,0,0.28)"
          }
        }
      }
    }
  </script>

  <style>
    /* –≤–∞–∂–Ω–æ: —Ñ–∏–∫—Å select/option, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –Ω–µ –ø—Ä–æ–ø–∞–¥–∞–ª */
    select, input, textarea { color: rgba(255,255,255,0.92); }
    select option { background: #0C2A20; color: #ffffff; }
    input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.40); }

    .glass {
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }

    /* –ª—ë–≥–∫–∏–π —Ñ–æ–Ω-–ø–∞—Ç—Ç–µ—Ä–Ω */
    .noise {
      background-image: radial-gradient(rgba(255,255,255,0.05) 1px, transparent 1px);
      background-size: 22px 22px;
      opacity: 0.14;
      pointer-events: none;
    }
  </style>
</head>

<body class="min-h-screen text-white bg-gradient-to-b from-bg0 to-bg1 overflow-x-hidden">

  <!-- —Ñ–æ–Ω -->
  <div class="fixed inset-0 pointer-events-none">
    <div class="absolute -top-40 -left-40 w-[560px] h-[560px] rounded-full bg-mint/16 blur-[95px]"></div>
    <div class="absolute top-0 -right-48 w-[620px] h-[620px] rounded-full bg-cyan/14 blur-[100px]"></div>
    <div class="absolute -bottom-60 left-1/3 w-[680px] h-[680px] rounded-full bg-white/10 blur-[120px]"></div>
    <div class="absolute inset-0 noise"></div>
  </div>

  <!-- TOP BAR -->
  <header class="relative z-10 w-full bg-solidBar border-b border-white/10">
    <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
      <a href="/" class="flex items-center gap-3 select-none">
        <div class="w-10 h-10 rounded-2xl bg-gradient-to-br from-mint to-cyan shadow-soft"></div>
        <div class="font-extrabold tracking-wide text-lg">AI School Helper</div>
      </a>

      <div class="flex items-center gap-2">
        <button class="px-4 py-2 rounded-xl border border-white/15 bg-white/5 hover:bg-white/10 transition"
                onclick="toast('–ü—Ä–æ–º–æ–∫–æ–¥—ã –±—É–¥—É—Ç –ø–æ–∑–∂–µ üôÇ')">–ü—Ä–æ–º–æ–∫–æ–¥</button>
        <button class="px-4 py-2 rounded-xl border border-white/15 bg-white/5 hover:bg-white/10 transition"
                onclick="toast('–ü—Ä–æ—Ñ–∏–ª—å/–≤—Ö–æ–¥ –±—É–¥–µ—Ç –ø–æ–∑–∂–µ üôÇ')">–ü—Ä–æ—Ñ–∏–ª—å</button>
      </div>
    </div>
  </header>

  <!-- Toast -->
  <div id="toast" class="fixed right-4 bottom-4 z-50 hidden">
    <div class="glass bg-black/55 border border-white/15 rounded-2xl px-4 py-3 shadow-soft">
      <div class="text-sm text-white/90" id="toastText">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>
    </div>
  </div>

  <main class="relative z-10">
    <div class="max-w-7xl mx-auto px-6 py-8">

      <!-- –ü–ê–†–ê–ú–ï–¢–†–´ ‚Äî —Å—Ç–µ–∫–ª—è–Ω–Ω–æ–µ –º–µ–Ω—é -->
      <section class="glass bg-glass border border-stroke rounded-3xl p-5 shadow-soft">
        <div class="flex items-center justify-between gap-3 mb-4">
          <div>
            <div class="text-sm text-white/65 font-bold">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
            <div class="text-xs text-white/55">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ –∫–ª–∞—Å—Å –∏ –ø—Ä–µ–¥–º–µ—Ç, –ø–æ—Ç–æ–º –≤–≤–µ–¥–∏ —Ç–µ–º—É.</div>
          </div>
          <div class="hidden sm:block text-xs text-white/55">
            –°–æ–≤–µ—Ç: —Ñ–æ—Ä–º—É–ª–∏—Ä—É–π —Ç–µ–º—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ ‚Äî –±—É–¥–µ—Ç —Ç–æ—á–Ω–µ–µ –æ—Ç–≤–µ—Ç.
          </div>
        </div>

        <!-- row 1 -->
        <div class="grid lg:grid-cols-3 gap-3">
          <div>
            <label class="text-xs text-white/70">–ö–ª–∞—Å—Å</label>
            <select id="grade"
              class="mt-2 w-full rounded-2xl border border-white/15 bg-white/5 px-3 py-3 outline-none
                     focus:ring-4 focus:ring-mint/15">
              <option>1-4</option>
              <option>5-6</option>
              <option selected>7-9</option>
              <option>10-11</option>
            </select>
          </div>

          <div>
            <label class="text-xs text-white/70">–û–±—ä—ë–º</label>
            <select id="level"
              class="mt-2 w-full rounded-2xl border border-white/15 bg-white/5 px-3 py-3 outline-none
                     focus:ring-4 focus:ring-cyan/15">
              <option>–ö—Ä–∞—Ç–∫–æ</option>
              <option selected>–°—Ä–µ–¥–Ω–µ</option>
              <option>–ü–æ–¥—Ä–æ–±–Ω–æ</option>
            </select>
          </div>

          <div>
            <label class="text-xs text-white/70">–¢–µ–º–∞</label>
            <input id="topic" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Å–∏–Ω—É—Å—ã, –±–∞–∫—Ç–µ—Ä–∏–∏, —É–º–Ω–æ–∂–µ–Ω–∏–µ –¥—Ä–æ–±–µ–π‚Ä¶"
              class="mt-2 w-full rounded-2xl border border-white/15 bg-white/5 px-3 py-3 outline-none
                     focus:ring-4 focus:ring-mint/15" />
          </div>
        </div>

        <!-- row 2 -->
        <div class="grid lg:grid-cols-3 gap-3 mt-3">
          <div>
            <label class="text-xs text-white/70">–ü—Ä–µ–¥–º–µ—Ç</label>
            <select id="subject"
              class="mt-2 w-full rounded-2xl border border-white/15 bg-white/5 px-3 py-3 outline-none
                     focus:ring-4 focus:ring-cyan/15">
            </select>
          </div>

          <div>
            <label class="text-xs text-white/70">–°—Ç–∏–ª—å</label>
            <select id="style"
              class="mt-2 w-full rounded-2xl border border-white/15 bg-white/5 px-3 py-3 outline-none
                     focus:ring-4 focus:ring-mint/15">
              <option selected>–ü—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º</option>
              <option>–ö–∞–∫ —É—á–∏—Ç–µ–ª—å</option>
              <option>–ù–∞—É—á–Ω–æ</option>
            </select>
          </div>

          <div class="flex items-end">
            <button id="btn" onclick="sendPrompt()"
              class="w-full rounded-2xl py-3 font-extrabold text-[#061611]
                     bg-gradient-to-r from-mint/90 to-cyan/80 hover:opacity-95 transition
                     disabled:opacity-60 shadow-soft">
              –û–±—ä—è—Å–Ω–∏—Ç—å —Ç–µ–º—É
            </button>
          </div>
        </div>

        <div class="mt-3 text-xs text-white/55">
          –î–∏—Å–∫–ª–µ–π–º–µ—Ä: —ç—Ç–æ –ø–æ–º–æ—â–Ω–∏–∫. –í–∞–∂–Ω—ã–µ –≤–µ—â–∏ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—è–π.
        </div>
      </section>

      <!-- –ù–ò–ñ–ï: –æ—Ç–≤–µ—Ç —Å–ª–µ–≤–∞ + –º–∞—Å–∫–æ—Ç —Å–ø—Ä–∞–≤–∞ -->
      <section class="mt-6 grid lg:grid-cols-[1fr_360px] gap-6 items-start">

        <!-- ANSWER -->
        <div class="rounded-3xl border border-white/10 bg-white/5 p-5 shadow-soft">
          <div class="flex items-center justify-between mb-3">
            <div class="font-black text-lg">–û—Ç–≤–µ—Ç</div>
            <div id="cacheMeta" class="text-xs px-3 py-1 rounded-full border border-white/15 bg-white/5">
              cache: ?
            </div>
          </div>

          <pre id="result" class="whitespace-pre-wrap text-white/90 text-sm leading-relaxed min-h-[280px]">–¢—É—Ç –ø–æ—è–≤–∏—Ç—Å—è –æ—Ç–≤–µ—Ç.</pre>
        </div>

        <!-- MASCOT (–Ω–∞ —Ñ–æ–Ω–µ, –±–µ–∑ –∫–∞—Ä—Ç–æ—á–∫–∏) -->
        <div class="relative min-h-[360px]">
          <div id="glow" class="absolute inset-0 rounded-3xl bg-cyan/10 blur-[44px]"></div>

          <div class="relative mx-auto w-[280px] h-[340px] opacity-95">
            <!-- EVA-like placeholder (–≥–æ–ª–æ–≤–∞ –æ—Ç–¥–µ–ª—å–Ω–æ + —Ç–µ–ª–æ –æ—Ç–¥–µ–ª—å–Ω–æ) -->
            <svg viewBox="0 0 280 340" class="w-full h-full">
              <defs>
                <linearGradient id="g" x1="0" x2="1">
                  <stop offset="0" stop-color="rgba(46,229,157,0.55)"/>
                  <stop offset="1" stop-color="rgba(0,212,255,0.45)"/>
                </linearGradient>
              </defs>

              <!-- head -->
              <rect x="62" y="18" rx="46" ry="46" width="156" height="116"
                fill="rgba(255,255,255,0.12)" stroke="rgba(255,255,255,0.20)" />

              <!-- body -->
              <rect x="48" y="160" rx="56" ry="56" width="184" height="150"
                fill="rgba(255,255,255,0.10)" stroke="rgba(255,255,255,0.20)" />

              <!-- magnet dot -->
              <circle cx="140" cy="148" r="7" fill="url(#g)"/>
            </svg>

            <div class="text-center text-xs text-white/60 -mt-2" id="mascotTag">default</div>

            <!-- tiny pink joke (–æ—á–µ–Ω—å —Å–ª–∞–±–æ) -->
            <div class="absolute -bottom-2 -right-2 w-10 h-10 rounded-full bg-pinky/12 blur-[18px]"></div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- FOOTER (—Å–ø–ª–æ—à–Ω–æ–π, –Ω–µ —Å—Ç–µ–∫–ª–æ) -->
  <footer class="relative z-10 w-full bg-solidBar border-t border-white/10 mt-10">
    <div class="max-w-7xl mx-auto px-6 py-6 text-xs text-white/60 flex flex-col sm:flex-row gap-2 sm:items-center sm:justify-between">
      <div>¬© 2026 Mihail Zayrenko</div>
      <div class="flex gap-4">
        <a class="hover:text-white/80 transition" href="/about">–û –ø—Ä–æ–µ–∫—Ç–µ</a>
        <a class="hover:text-white/80 transition" href="/empty">Empty</a>
        <a class="hover:text-white/80 transition" href="/">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
      </div>
    </div>
  </footer>

  <script>
    function toast(text){
      const t = document.getElementById('toast');
      const tt = document.getElementById('toastText');
      tt.textContent = text || '–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ';
      t.classList.remove('hidden');
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=>t.classList.add('hidden'), 2200);
    }

    // –ü—Ä–µ–¥–º–µ—Ç—ã –ø–æ –∫–ª–∞—Å—Å—É (—Ç–≤–æ–π —Å–ø–∏—Å–æ–∫)
    const subjectsByGrade = {
      "1-4": ["–†—É—Å—Å–∫–∏–π —è–∑—ã–∫","–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫","–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ","–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞","–û–∫—Ä—É–∂–∞—é—â–∏–π –º–∏—Ä","–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è","–§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞","–ò–ó–û","–ú—É–∑—ã–∫–∞"],
      "5-6": ["–†—É—Å—Å–∫–∏–π —è–∑—ã–∫","–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞","–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞","–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫","–ë–∏–æ–ª–æ–≥–∏—è","–ì–µ–æ–≥—Ä–∞—Ñ–∏—è","–ò—Å—Ç–æ—Ä–∏—è","–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ","–ú—É–∑—ã–∫–∞","–ò–ó–û","–§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞","–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è/–¢—Ä—É–¥","–û–ë–ó–†"],
      "7-9": ["–†—É—Å—Å–∫–∏–π —è–∑—ã–∫","–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞","–ê–ª–≥–µ–±—Ä–∞","–ì–µ–æ–º–µ—Ç—Ä–∏—è","–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫","–ù–µ–º–µ—Ü–∫–∏–π —è–∑—ã–∫","–ò—Å—Ç–æ—Ä–∏—è","–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ","–ì–µ–æ–≥—Ä–∞—Ñ–∏—è","–ë–∏–æ–ª–æ–≥–∏—è","–§–∏–∑–∏–∫–∞","–•–∏–º–∏—è","–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ (–ò–í–¢)","–ú—É–∑—ã–∫–∞","–ò–ó–û","–§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞","–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è/–¢—Ä—É–¥","–û–ë–ó–†"],
      "10-11": ["–†—É—Å—Å–∫–∏–π —è–∑—ã–∫","–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞","–ê–ª–≥–µ–±—Ä–∞","–ì–µ–æ–º–µ—Ç—Ä–∏—è","–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫","–ò—Å—Ç–æ—Ä–∏—è","–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ","–ì–µ–æ–≥—Ä–∞—Ñ–∏—è","–ë–∏–æ–ª–æ–≥–∏—è","–§–∏–∑–∏–∫–∞","–•–∏–º–∏—è","–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ (–ò–í–¢)","–§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞","–û–ë–ó–†"]
    };

    const gradeEl = document.getElementById("grade");
    const subjectEl = document.getElementById("subject");
    const resultEl = document.getElementById("result");
    const btnEl = document.getElementById("btn");
    const cacheMeta = document.getElementById("cacheMeta");
    const mascotTag = document.getElementById("mascotTag");
    const glow = document.getElementById("glow");

    function setSubjectsForGrade(){
      const g = gradeEl.value;
      const subjects = subjectsByGrade[g] || [];
      const prev = subjectEl.value;

      subjectEl.innerHTML = "";
      subjects.forEach(s=>{
        const opt = document.createElement("option");
        opt.value = s;
        opt.textContent = s;
        subjectEl.appendChild(opt);
      });

      if (subjects.includes(prev)) subjectEl.value = prev;
      updateMascot();
    }

    function updateMascot(){
      const s = subjectEl.value || "default";
      mascotTag.textContent = s;

      // –º—è–≥–∫–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É
      let cl = "rgba(0,212,255,0.12)";
      if (s.includes("–•–∏–º")) cl = "rgba(46,229,157,0.16)";
      if (s.includes("–§–∏–∑")) cl = "rgba(0,212,255,0.18)";
      if (s.includes("–†—É—Å") || s.includes("–õ–∏—Ç")) cl = "rgba(255,255,255,0.12)";
      if (s.includes("–ê–ª–≥") || s.includes("–ì–µ–æ–º") || s.includes("–ú–∞—Ç–µ–º")) cl = "rgba(46,229,157,0.13)";
      glow.style.background = cl;
    }

    gradeEl.addEventListener("change", setSubjectsForGrade);
    subjectEl.addEventListener("change", updateMascot);

    // init
    setSubjectsForGrade();

    // –ø–ª–∞–≤–Ω—ã–π –≤—ã–≤–æ–¥ –æ—Ç–≤–µ—Ç–∞
    async function typeLines(text){
      resultEl.textContent = "";
      const lines = (text || "").split("\n");
      for (let i=0;i<lines.length;i++){
        resultEl.textContent += lines[i] + (i === lines.length-1 ? "" : "\n");
        if (i % 3 === 0) await new Promise(r=>setTimeout(r, 10));
      }
    }

    async function sendPrompt(){
      const grade = gradeEl.value;
      const subject = subjectEl.value;
      const level = document.getElementById("level").value;
      const style = document.getElementById("style").value;
      const topic = document.getElementById("topic").value;

      if(!topic.trim()){
        toast("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É üôÇ");
        return;
      }

      btnEl.disabled = true;
      cacheMeta.textContent = "cache: ‚Ä¶";
      resultEl.textContent = "–ì–µ–Ω–µ—Ä–∏—Ä—É—é –æ—Ç–≤–µ—Ç‚Ä¶";

      try{
        const resp = await fetch("/generate", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ grade, subject, level, style, topic })
        });

        const data = await resp.json().catch(()=>null);

        if(!resp.ok){
          const msg = (data && data.error) ? data.error : ("HTTP " + resp.status);
          resultEl.textContent = "–û—à–∏–±–∫–∞: " + msg;
          cacheMeta.textContent = "cache: ?";
          return;
        }

        if (data && data.error){
          resultEl.textContent = "–û—à–∏–±–∫–∞: " + data.error;
          cacheMeta.textContent = "cache: ?";
          return;
        }

        cacheMeta.textContent = (data && data.cached) ? "cache: HIT" : "cache: MISS";
        await typeLines((data && data.answer) ? data.answer : "–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç.");

      } catch(e){
        console.error(e);
        resultEl.textContent = "–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É.";
        cacheMeta.textContent = "cache: ?";
      } finally{
        btnEl.disabled = false;
      }
    }
  </script>
</body>
</html>
